<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Satış Listesi</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="sticky top-0 bg-white z-10 shadow p-4 space-y-3">
    <input id="searchInput" type="text" placeholder="Ara..." class="border p-2 rounded w-full" />
    <div id="resultCount" class="text-sm text-center text-gray-600 mt-1"></div>
  </div>

  <div id="listContainer" class="p-4 space-y-4"></div>

  <script>
    const apiUrl = "https://api.github.com/repos/isemfer-ux/alsat_yapi/contents/satis_listesi.json";

    function normalize(str) {
      return str
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/ç/g, "c").replace(/ğ/g, "g")
        .replace(/ı/g, "i").replace(/ö/g, "o")
        .replace(/ş/g, "s").replace(/ü/g, "u");
    }

    function formatNumber(n) {
      return parseInt(n).toLocaleString("tr-TR");
    }

    function renderList(data) {
      const container = document.getElementById("listContainer");
      const query = normalize(document.getElementById("searchInput").value);
      const terms = query.split(" ").filter(Boolean);

      const filtered = data.filter(item => {
        const aciklama = normalize(item.aciklama || "");
        return terms.every(term => aciklama.includes(term));
      });

      container.innerHTML = "";

      filtered.forEach(item => {
        const box = document.createElement("div");
        box.className = "bg-white rounded shadow p-4 space-y-2";

        const title = `${item.satkir} ${item.tip} - ${item.ilce} - ${item.m2net} m²`;
        const fiyat = `${formatNumber(item.sfiyat)} ₺`;

        box.innerHTML = `
          <div class="flex justify-between items-center">
            <div class="font-bold">${title}</div>
            <div class="text-green-600 font-semibold">${fiyat}</div>
          </div>
          <button class="text-blue-500 underline text-sm toggle-details">Detay Göster</button>
          <div class="details hidden text-sm mt-2 space-y-1">
            <div><strong>Açıklama:</strong> ${item.aciklama}</div>
          </div>
        `;
        container.appendChild(box);
      });

      document.querySelectorAll(".toggle-details").forEach(btn => {
        btn.addEventListener("click", () => {
          const details = btn.nextElementSibling;
          details.classList.toggle("hidden");
          btn.textContent = details.classList.contains("hidden") ? "Detay Göster" : "Detay Gizle";
        });
      });

      document.getElementById("resultCount").textContent = `${filtered.length} ürün bulundu`;
    }

    document.getElementById("searchInput").addEventListener("input", () => {
      if (window.rawData) renderList(window.rawData);
    });

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        try {
          const jsonString = atob(data.content);
          const json = JSON.parse(jsonString);
          window.rawData = json;
          renderList(json);
        } catch (e) {
          console.error("JSON ayrıştırma hatası:", e);
        }
      })
      .catch(error => console.error("Veri çekme hatası:", error));
  </script>
</body>
</html>
