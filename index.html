<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Satış Listesi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .filter-btn {
      @apply px-3 py-1 rounded font-medium transition-all text-sm;
    }
    .group-satkir {
      background-color: #e0f2fe;
      color: #0284c7;
    }
    .group-satkir.active {
      background-color: #0284c7;
      color: white;
    }

    .group-tip {
      background-color: #fef3c7;
      color: #b45309;
    }
    .group-tip.active {
      background-color: #b45309;
      color: white;
    }

    .group-ilce {
      background-color: #ecfccb;
      color: #15803d;
    }
    .group-ilce.active {
      background-color: #15803d;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Üst Arama + Filtre -->
  <div class="sticky top-0 bg-white z-10 shadow p-4 space-y-3">
    <input id="searchInput" type="text" placeholder="Ara..." class="border p-2 rounded w-full" />

    <div class="flex flex-wrap gap-2 text-center">
      <!-- Sat/Kir -->
      <button class="filter-btn group-satkir" data-group="satkir" data-value="SATILIK">SATILIK</button>
      <button class="filter-btn group-satkir" data-group="satkir" data-value="KİRALIK">KİRALIK</button>

      <!-- Tip -->
      <button class="filter-btn group-tip" data-group="tip" data-value="DAİRE">DAİRE</button>
      <button class="filter-btn group-tip" data-group="tip" data-value="DÜKKAN">DÜKKAN</button>
      <button class="filter-btn group-tip" data-group="tip" data-value="ARSA">ARSA</button>

      <!-- İlçe -->
      <button class="filter-btn group-ilce" data-group="ilce" data-value="AKÇALAR">AKÇALAR</button>
      <button class="filter-btn group-ilce" data-group="ilce" data-value="NİLÜFER">NİLÜFER</button>
      <button class="filter-btn group-ilce" data-group="ilce" data-value="BURSA">BURSA</button>
    </div>

    <div id="resultCount" class="text-sm text-center text-gray-600"></div>
  </div>

  <!-- Liste -->
  <div id="listContainer" class="p-4 space-y-4"></div>

  <script>
    const apiUrl = "https://api.github.com/repos/isemfer-ux/alsat_yapi/contents/satis_listesi.json";
    const filters = {};

    function fetchData() {
      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          const json = JSON.parse(atob(data.content));
          renderList(json);
        });
    }

    function formatNumber(n) {
      return parseInt(n).toLocaleString("tr-TR");
    }

    function renderList(data) {
      const container = document.getElementById("listContainer");
      const query = document.getElementById("searchInput").value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

      const filtered = data.filter(item => {
        // Arama
        const haystack = Object.values(item).join(" ").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const terms = query.split(" ").filter(x => x.length > 0);
        const searchMatch = terms.every(term => haystack.includes(term));

        // Filtre
        const groupMatch = Object.keys(filters).every(key => filters[key].length === 0 || filters[key].includes(item[key]));

        return searchMatch && groupMatch;
      });

      container.innerHTML = "";

      filtered.forEach(item => {
        const box = document.createElement("div");
        box.className = "bg-white rounded shadow p-4 space-y-2";

        const title = `${item.satkir} ${item.tip} - ${item.ilce} - ${item.m2net} m²`;
        const fiyat = `${formatNumber(item.sfiyat)} ₺`;

        box.innerHTML = `
          <div class="flex justify-between items-center">
            <div class="font-bold">${title}</div>
            <div class="text-green-600 font-semibold">${fiyat}</div>
          </div>
          <button class="text-blue-500 underline text-sm toggle-details">Detay Göster</button>
          <div class="details hidden text-sm mt-2 space-y-1">
            ${item.aciklama ? `<div><strong>Açıklama:</strong> ${item.aciklama}</div>` : ""}
            ${item.ozellikler?.length ? `<div><strong>Özellikler:</strong> ${item.ozellikler.join(", ")}</div>` : ""}
            <div><strong>Adres:</strong> ${item.il}, ${item.ilce}, ${item.mahalle}</div>
            <div><strong>Kat:</strong> ${item.kat} - Daire No: ${item.daire}</div>
            <div><strong>Net/Brüt:</strong> ${item.m2net} / ${item.m2brut} m²</div>
            <div><strong>Durum:</strong> ${item.durum}</div>
          </div>
        `;
        container.appendChild(box);
      });

      document.querySelectorAll(".toggle-details").forEach(btn => {
        btn.addEventListener("click", () => {
          const details = btn.nextElementSibling;
          details.classList.toggle("hidden");
          btn.textContent = details.classList.contains("hidden") ? "Detay Göster" : "Detay Gizle";
        });
      });

      document.getElementById("resultCount").textContent = `${filtered.length} ürün bulundu`;
    }

    // Arama
    document.getElementById("searchInput").addEventListener("input", () => renderList(window.rawData));

    // Butonlar
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const group = btn.dataset.group;
        const value = btn.dataset.value;

        filters[group] = filters[group] || [];
        if (filters[group].includes(value)) {
          filters[group] = filters[group].filter(v => v !== value);
          btn.classList.remove("active");
        } else {
          filters[group].push(value);
          btn.classList.add("active");
        }

        renderList(window.rawData);
      });
    });

    // Linkle arama başlat
    function initFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const q = urlParams.get("arama");
      if (q) {
        document.getElementById("searchInput").value = q;
      }
    }

    // Başlat
    fetchData();
    initFromURL();
    window.rawData = [];
    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        const json = JSON.parse(atob(data.content));
        window.rawData = json;
        renderList(json);
      });
  </script>
</body>
</html>
